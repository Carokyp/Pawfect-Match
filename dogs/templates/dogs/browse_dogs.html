{% extends "base_auth.html" %}
{% load static %}

{% block title %}Discover{% endblock %}
{% block content_class %}discover-page-wrapper{% endblock %}

{% block content %}

<div class="discover-page">

  <!-- APP HEADER -->
  <header class="discover-header">
    <h1 class="app-logo m-0">Pawfect Match</h1>
  </header>

  {% if dog %}

  <!-- PROFILE CARD -->
  <div class="profile-card">

    <!-- TOGGLE -->
    <div class="profile-toggle">
      <button class="toggle-btn active" data-view="dog">Dog</button>
      <button class="toggle-btn" data-view="owner">Owner</button>
    </div>

    <!-- DOG VIEW -->
    <div class="profile-view dog-view">

      <div class="profile-image">
        {% if dog.profile_photo %}
          <img src="{{ dog.get_photo_url }}" alt="Dog photo">
        {% else %}
          <img src="{% static 'images/dog_placeholder.png' %}" alt="Dog placeholder">
        {% endif %}

        <div class="image-overlay left">
          <h2>{{ dog.name }}, {{ dog.age }}</h2>
          <p>{{ dog.breed }}</p>
          <p>{{ dog.owner.city }}</p>
        </div>
      </div>

      <hr class="profile-divider">

      <div class="profile-about center">
        <h3>About me</h3>
        <p>{{ dog.about_me }}</p>
      </div>

      <hr class="profile-divider">

      <div class="profile-meta">
        <div class="meta-block">
          <h4>Energy level</h4>
          <span class="tag">{{ dog.get_energy_level_display }}</span>
        </div>

        <div class="meta-block">
          <h4>Size</h4>
          <span class="tag">{{ dog.get_size_display }}</span>
        </div>
      </div>

    </div>

    <!-- OWNER VIEW -->
    <div class="profile-view owner-view hidden">

      <div class="profile-image">
        {% if dog.owner.profile_photo %}
          <img src="{{ dog.owner.get_photo_url }}" alt="Owner photo">
        {% else %}
          <img src="{% static 'images/owner_placeholder.png' %}" alt="Owner placeholder">
        {% endif %}

        <div class="image-overlay left">
          <h2>{{ dog.owner.name }}, {{ dog.owner.age }}</h2>
          <p>{{ dog.owner.occupation }}</p>
          <p>{{ dog.owner.city }}</p>
        </div>
      </div>

      <hr class="profile-divider">

      <div class="profile-about center">
        <h3>About me</h3>
        <p>{{ dog.owner.about_me }}</p>
      </div>

      <hr class="profile-divider">

      <div class="profile-interests left">
        <h4>Interests</h4>
        <div class="profile-tags">
          {% for interest in dog.owner.interests_list %}
            <span class="tag">{{ interest }}</span>
          {% endfor %}
        </div>
      </div>

    </div>

    <!-- ACTION BUTTONS -->
    <div class="action-buttons">
      <form method="POST" action="{% url 'next_dog' %}">
        {% csrf_token %}
        <button type="submit" class="action-btn dislike" aria-label="Dislike">
          ‚úï
        </button>
      </form>

      <form method="POST" action="{% url 'like_dog' dog.id %}">
        {% csrf_token %}
        <button type="submit" class="action-btn like" aria-label="Like">
          ‚ù§
        </button>
      </form>
    </div>

    <!-- BOTTOM NAV -->
    <nav class="bottom-nav">
      <a href="{% url 'browse_dogs' %}" class="active">Discover</a>
      <a href="{% url 'matches_list' %}">Matches</a>
      <a href="{% url 'view_profile' %}">Profile</a>
    </nav>

  </div>

  {% else %}

  <div class="empty-dogs">
    <p class="empty-dogs-title">
      You've discovered all available pups! üêæ
    </p>
    <p class="empty-dogs-subtitle">
      New matches may appear soon
    </p>
    <form method="POST" action="{% url 'reset_matches' %}" style="margin-top: 20px;">
      {% csrf_token %}
      <button type="submit" class="btn-reset-matches" id="resetMatchesBtn">
        Reset Matches
      </button>
    </form>
  </div>

  {% endif %}

  <!-- BOTTOM NAV (Always visible) -->
  <nav class="bottom-nav">
    <a href="{% url 'browse_dogs' %}" class="active">Discover</a>
    <a href="{% url 'matches_list' %}">Matches</a>
    <a href="{% url 'view_profile' %}">Profile</a>
  </nav>

</div>

{% if match_popup %}
<div class="modal-backdrop is-open" id="matchModal">
  <div class="match-modal">
    <button class="close" type="button" aria-label="Close" id="closeMatchModal">√ó</button>
    <h2>It's a match with {{ match_popup.other_dog_name }}!</h2>

    <div class="match-avatars">
      {% if match_popup.my_dog_photo %}
        <img src="{{ match_popup.my_dog_photo }}" alt="My dog">
      {% else %}
        <img src="{% static 'images/dog_placeholder.png' %}" alt="My dog">
      {% endif %}
      
      <div class="match-heart">üíñ</div>
      
      {% if match_popup.other_dog_photo %}
        <img src="{{ match_popup.other_dog_photo }}" alt="Matched dog">
      {% else %}
        <img src="{% static 'images/dog_placeholder.png' %}" alt="Matched dog">
      {% endif %}
    </div>
    <p>You and {{ match_popup.other_dog_name }} found each other</p>

    <div>
      <a class="btn-outline" href="{% url 'matches_list' %}">View Matches</a>
    </div>
  </div>
</div>
{% endif %}

{% endblock %}
