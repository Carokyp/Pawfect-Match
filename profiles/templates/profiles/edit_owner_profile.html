{% extends "base_auth.html" %}
{% load static %}

{% block title %}Edit My Profile{% endblock %}
{% block content_class %}edit-profile-wrapper{% endblock %}

{% block content %}

<div class="profile-page profile-edit-page">

  <!-- APP HEADER -->
  <header class="app-header">
    <h1 class="app-logo m-0">Pawfect Match</h1>
  </header>

  <div class="profile-toolbar">
    <span class="profile-title">PROFILE</span>
    <a href="{% url 'view_profile' %}" class="profile-gear" aria-label="View profile">⚙️</a>
  </div>

  <form method="post" enctype="multipart/form-data" class="profile-form-modern profile-edit-form">
    {% csrf_token %}

    <div class="photo-block">
      <label class="form-label">Profile Photo</label>
      <div class="upload-box {% if form.instance.profile_photo %}has-image{% endif %}">
        {{ form.profile_photo }}
        <img class="image-preview{% if form.instance.profile_photo %} is-visible{% endif %}"
             {% if form.instance.profile_photo %}src="{{ form.instance.get_photo_url }}"{% endif %}
             alt="Profile preview">
        <span class="upload-placeholder">Change photo</span>
        <button type="button" class="upload-remove" aria-label="Remove image">×</button>
      </div>
    </div>

    <div class="form-grid">
      <div class="form-field">
        <label class="form-label" for="{{ form.name.id_for_label }}">Name</label>
        {{ form.name }}
      </div>

      <div class="form-field">
        <label class="form-label" for="{{ form.age.id_for_label }}">Age</label>
        {{ form.age }}
      </div>

      <div class="form-field">
        <label class="form-label" for="{{ form.occupation.id_for_label }}">Occupation</label>
        {{ form.occupation }}
      </div>

      <div class="form-field">
        <label class="form-label" for="{{ form.city.id_for_label }}">Location</label>
        {{ form.city }}
      </div>

      <div class="form-field form-field-full">
        <label class="form-label" for="{{ form.interests.id_for_label }}">Interests</label>
        {{ form.interests }}
      </div>

      <div class="form-field form-field-full">
        <label class="form-label" for="{{ form.about_me.id_for_label }}">About me</label>
        {{ form.about_me }}
        <div class="char-counter">0 / 500</div>
      </div>
    </div>

    <div class="form-actions">
      <a href="{% url 'view_profile' %}" class="btn-secondary">Cancel</a>
      <button type="submit" class="btn-primary">Save owner profile</button>
    </div>
  </form>

  <!-- DANGER ZONE -->
  <div class="danger-zone">
    <h3 class="danger-zone-title">⚠️ Danger Zone</h3>
    <p class="danger-zone-text">Delete your profile and your dog</p>
    <p class="danger-zone-subtext">This action is permanent and cannot be undone.</p>
    
    <form method="post" action="{% url 'delete_profile' %}" id="deleteForm">
      {% csrf_token %}
      <button type="button" class="btn-danger" onclick="openDeleteModal()">Delete My Profile</button>
    </form>
  </div>

  <!-- DELETE CONFIRMATION MODAL -->
  <div class="modal-overlay" id="deleteModal">
    <div class="modal-content">
      <h2>Are you sure?</h2>
      <p class="modal-warning">⚠️ This will permanently delete:</p>
      <ul class="modal-list">
        <li>Your profile</li>
        <li>Your dog: <strong>{{ dog.name }}</strong></li>
        <li>All your matches</li>
      </ul>
      <p class="modal-danger">This action cannot be undone.</p>
      
      <div class="modal-actions">
        <button type="button" class="btn-secondary" onclick="closeDeleteModal()">Cancel</button>
        <button type="button" class="btn-danger" onclick="confirmDelete()">Yes, Delete Forever</button>
      </div>
    </div>
  </div>

  <script>
    function openDeleteModal() {
      document.getElementById('deleteModal').classList.add('is-open');
    }

    function closeDeleteModal() {
      document.getElementById('deleteModal').classList.remove('is-open');
    }

    function confirmDelete() {
      document.getElementById('deleteForm').submit();
    }

    // Close modal on backdrop click
    document.getElementById('deleteModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeDeleteModal();
      }
    });
  </script>

</div>

{% endblock %}
